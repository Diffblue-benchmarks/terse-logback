package com.tersesystems.logback.context;

import org.slf4j.Logger;
import org.slf4j.Marker;

/**
 * Proxy logger that takes a marker as argument.
 */
public class ProxyContextLogger<T extends Marker> implements Logger, ContextAware<T> @ob

    private final Logger logger;
    private final Context<T> context;

    public ProxyContextLogger(Context<T> context, Logger logger) {
        if (logger instanceof ContextAware) {
            this.context = context.and(((ContextAware) logger).getContext());
        } else {
            this.context = context;
        }
        this.logger = logger;
    }
    @Override
    public String getName() {
        return logger.getName();
    }

    @Override
    public Context<T> getContext() {
        return this.context;
    }

    @for(level <- Seq(
      Level("trace", "Trace"),
      Level("debug", "Debug"),
      Level("info", "Info"),
      Level("warn", "Warn"),
      Level("error", "Error"),
    )) {
    @Override
    public boolean is@{level.capitalizedName}Enabled() @ob
        return logger.is@{level.capitalizedName}Enabled(context.asMarker());
    @cb

    @Override
    public void @{level.name}(String msg) @ob
        logger.@{level.name}(context.asMarker(), msg);
    @cb

    @Override
    public void @{level.name}(String format, Object arg) @ob
        logger.@{level.name}(context.asMarker(), format, arg);
    @cb

    @Override
    public void @{level.name}(String format, Object arg1, Object arg2) @ob
        logger.@{level.name}(context.asMarker(), format, arg1, arg2);
    @cb

    @Override
    public void @{level.name}(String format, Object... arguments) @ob
         logger.@{level.name}(context.asMarker(), format, arguments);
    @cb

    @Override
    public void @{level.name}(String msg, Throwable t) @ob
         logger.@{level.name}(context.asMarker(), msg, t);
    @cb

    @Override
    public boolean is@{level.capitalizedName}Enabled(Marker marker) @ob
         Marker contextMarker = context.asMarker();
         contextMarker.add(marker);
         return logger.is@{level.capitalizedName}Enabled(contextMarker);
    @cb

    @Override
    public void @{level.name}(Marker marker, String msg) @ob
        Marker contextMarker = context.asMarker();
        contextMarker.add(marker);
        logger.@{level.name}(contextMarker, msg);
    @cb

    @Override
    public void @{level.name}(Marker marker, String format, Object arg) @ob
       Marker contextMarker = context.asMarker();
       contextMarker.add(marker);
       logger.@{level.name}(contextMarker, format, arg);
    @cb

    @Override
    public void @{level.name}(Marker marker, String format, Object arg1, Object arg2) @ob
        Marker contextMarker = context.asMarker();
        contextMarker.add(marker);
        logger.@{level.name}(contextMarker, format, arg1, arg2);
    @cb

    @Override
    public void @{level.name}(Marker marker, String format, Object... argArray) @ob
       Marker contextMarker = context.asMarker();
       contextMarker.add(marker);
       logger.@{level.name}(contextMarker, format, argArray);
    @cb

    @Override
    public void @{level.name}(Marker marker, String msg, Throwable t) @ob
       Marker contextMarker = context.asMarker();
       contextMarker.add(marker);
       logger.@{level.name}(contextMarker, msg, t);
    @cb
    }
@cb